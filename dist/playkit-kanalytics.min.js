!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("playkit-js")):"function"==typeof define&&define.amd?define(["playkit-js"],t):"object"==typeof exports?exports.PlaykitJsKAnalytics=t(require("playkit-js")):e.PlaykitJsKAnalytics=t(e.Playkit)}(this,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=n(2),c=r(l),f=n(3),p=r(f),d=n(4),y=r(d),h=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return a._initializeMembers(),a._registerListeners(),a._sendAnalytics(p.default.WIDGET_LOADED),n.ready().then(function(){a._sendAnalytics(p.default.MEDIA_LOADED)}),a}return a(t,e),s(t,null,[{key:"isValid",value:function(){return!0}}]),s(t,[{key:"destroy",value:function(){this.eventManager.destroy()}},{key:"_registerListeners",value:function(){var e=this.player.Event;this.eventManager.listen(this.player,e.FIRST_PLAY,this._sendAnalytics.bind(this,p.default.PLAY)),this.eventManager.listen(this.player,e.PLAY,this._onPlay.bind(this)),this.eventManager.listen(this.player,e.ENDED,this._onEnded.bind(this)),this.eventManager.listen(this.player,e.SEEKED,this._sendSeekAnalytic.bind(this)),this.eventManager.listen(this.player,e.TIME_UPDATE,this._sendTimePercentAnalytic.bind(this)),this.eventManager.listen(this.player,e.PLAYER_STATE_CHANGED,this._onPlayerStateChanged.bind(this))}},{key:"_onPlay",value:function(){this._ended&&(this._ended=!1,this._sendAnalytics(p.default.REPLAY))}},{key:"_onEnded",value:function(){this._ended=!0}},{key:"_onPlayerStateChanged",value:function(e){e.payload.newState===this.player.State.BUFFERING&&this._sendAnalytics(p.default.BUFFER_START),e.payload.oldState===this.player.State.BUFFERING&&this._sendAnalytics(p.default.BUFFER_END)}},{key:"_sendSeekAnalytic",value:function(){var e=(new Date).getTime();(0===this._lastSeekEvent||this._lastSeekEvent+2e3<e)&&this._sendAnalytics(p.default.SEEK),this._lastSeekEvent=e,this._hasSeeked=!0}},{key:"_sendTimePercentAnalytic",value:function(){var e=this.player.currentTime/this.player.duration;!this._timePercentEvent.PLAY_REACHED_25&&e>=.25&&(this._timePercentEvent.PLAY_REACHED_25=!0,this._sendAnalytics(p.default.PLAY_REACHED_25)),!this._timePercentEvent.PLAY_REACHED_50&&e>=.5&&(this._timePercentEvent.PLAY_REACHED_50=!0,this._sendAnalytics(p.default.PLAY_REACHED_50)),!this._timePercentEvent.PLAY_REACHED_75&&e>=.75&&(this._timePercentEvent.PLAY_REACHED_75=!0,this._sendAnalytics(p.default.PLAY_REACHED_75)),!this._timePercentEvent.PLAY_REACHED_100&&e>=.98&&(this._timePercentEvent.PLAY_REACHED_100=!0,this._sendAnalytics(p.default.PLAY_REACHED_100))}},{key:"_sendAnalytics",value:function(e){var t=this,n=new y.default(e);n.currentPoint=this.player.currentTime,n.duration=this.player.duration,n.seek=this._hasSeeked,n.hasKanalony=this.config.hasKanalony,Object.assign(n,this._playerParams),c.default.collect(this._ks,{event:n},this.config.baseUrl).doHttpRequest().then(function(){t.logger.debug("Analytics event sent ",n)},function(e){t.logger.error("Failed to send analytics event ",n,e)})}},{key:"_initializeMembers",value:function(){this._playerConfParams=null,this._ks="",this._ended=!1,this._timePercentEvent={},this._lastSeekEvent=0,this._hasSeeked=!1}},{key:"_playerParams",get:function(){if(!this._playerConfParams){var e=this.player.config,t={clientVer:u.VERSION,referrer:document.referrer,entryId:e.id,uiconfId:0},n=e.session;n&&(t.sessionId=n.id,t.partnerId=n.partnerID,t.widgetId="_"+n.partnerID,t.uiconfId=n.uiConfID,this._ks=n.ks),e.contextId&&(t.contextId=e.contextId),e.featureType&&(t.featureType=e.featureType),e.applicationId&&(t.applicationId=e.applicationId),e.userId&&(t.userId=e.userId),this._playerConfParams=t}return this._playerConfParams}}]),t}(u.BasePlugin);h.defaultConfig={baseUrl:"http://stats.kaltura.com/api_v3/index.php",hasKanalony:!1},t.default=h,(0,u.registerPlugin)("kanalytics",h)},function(t,n){t.exports=e},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=37)}({0:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Map;r(this,e),this.headers=t}return i(e,[{key:"getUrl",value:function(e){return e+"/service/"+this.service+(this.action?"/action/"+this.action:"")}},{key:"doHttpRequest",value:function(){var e=this;if(!this.url)throw new Error("baseUrl is mandatory for request builder");var t=new XMLHttpRequest;return new Promise(function(n,r){t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){var e=JSON.parse(t.responseText);e&&"object"===(void 0===e?"undefined":o(e))&&e.code&&e.message?r(e):n(e)}else r(t.responseText)},t.open(e.method,e.url),e.headers.forEach(function(e,n){t.setRequestHeader(n,e)}),t.send(e.params)})}}]),e}();t.default=a},1:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i={beUrl:"http://www.kaltura.com/api_v3",baseUrl:"https://cdnapisec.kaltura.com",serviceParams:{clientTag:"playkit-js",apiVersion:"3.3.0",format:1}},a=function(){function e(){r(this,e)}return o(e,null,[{key:"set",value:function(e){e&&Object.assign(i,e)}},{key:"get",value:function(){return i}}]),e}();t.default=a,t.Configuration=a},2:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t){r(this,e),this.hasError=!1,"KalturaAPIException"===t.objectType?(this.hasError=!0,this.error=new i(t.code,t.message)):this.data=t};t.default=o;var i=function e(t,n){r(this,e),this.code=t,this.message=n}},3:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(5),s=r(a),u=n(1),l=r(u),c=l.default.get(),f=function(){function e(){o(this,e)}return i(e,null,[{key:"getMultirequest",value:function(e,t){var n=c.serviceParams;Object.assign(n,{ks:e}),t&&Object.assign(n,{partnerId:t});var r=new Map;r.set("Content-Type","application/json");var o=new s.default(r);return o.method="POST",o.service="multirequest",o.url=o.getUrl(c.beUrl),o.params=n,o}}]),e}();t.default=f},37:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.RequestBuilder=t.Configuration=t.StatsService=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),l=r(u),c=n(0),f=r(c),p=n(1),d=r(p),y=n(38),h=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,null,[{key:"collect",value:function(e,t,n){var r=d.default.get(),o={};Object.assign(o,r.serviceParams,{ks:e},t);var i=new f.default;return i.service="stats",i.action="collect",i.method="GET",i.tag="stats-collect",i.params=o,i.url=n+"?service="+i.service+"&action="+i.action+"&"+(0,y.param)(i.params),i}}]),t}(l.default);t.default=h,t.StatsService=h,t.Configuration=d.default,t.RequestBuilder=f.default},38:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e){var t=[],n=/\[\]$/,o=function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=function(e,n){n="function"==typeof n?n():null===n?"":void 0===n?"":n,t[t.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)};return function e(a,s){var u=void 0,l=void 0,c=void 0;if(a)if(o(s))for(u=0,l=s.length;u<l;u++)n.test(a)?i(a,s[u]):e(a+":"+("object"===r(s[u])?u:""),s[u]);else if(s&&"[object Object]"===String(s))for(c in s)e(a+":"+c,s[c]);else i(a,s);else if(o(s))for(u=0,l=s.length;u<l;u++)i(s[u].name,s[u].value);else for(c in s)e(c,s[c]);return t}("",e).join("&").replace(/%20/g,"+")};t.param=o},4:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.LOG_LEVEL=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(6),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i),s=function(){function e(t){r(this,e),a.useDefaults(t||{})}return o(e,[{key:"get",value:function(e){return e?a.get(e):a}}]),e}(),u=new s({defaultLevel:a.DEBUG}),l={DEBUG:a.DEBUG,INFO:a.INFO,TIME:a.TIME,WARN:a.WARN,ERROR:a.ERROR,OFF:a.OFF};t.default=u,t.LOG_LEVEL=l},5:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.MultiRequestResult=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),c=r(l),f=n(2),p=r(f),d=n(4),y=r(d),h=y.default.get("OvpProvider"),v=function(e){function t(){var e,n,r,o;i(this,t);for(var s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),r.requests=[],o=n,a(r,o)}return s(t,e),u(t,[{key:"add",value:function(e){this.requests.push(e);var t={},n={service:e.service,action:e.action};return Object.assign(t,o({},this.requests.length,Object.assign(n,e.params))),Object.assign(t,this.params),this.params=t,this}},{key:"execute",value:function(){var e=this;try{this.params=JSON.stringify(this.params)}catch(e){h.error(""+e.message)}return new Promise(function(t,n){e.doHttpRequest().then(function(e){t(new _(e))},function(e){n("Error on multiRequest execution, error <"+e+">.")})})}}]),t}(c.default);t.default=v;var _=t.MultiRequestResult=function e(t){var n=this;i(this,e),this.results=[],this.success=!0,t.forEach(function(e){var t=new p.default(e);if(n.results.push(t),t.hasError)return h.error("Service returned an error with error code: "+t.error.code+" and message: "+t.error.message+"."),void(n.success=!1)})}},6:function(e,t,n){var r,o;/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */
!function(i){"use strict";var a={};a.VERSION="1.4.1";var s,u={},l=function(e,t){return function(){return t.apply(e,arguments)}},c=function(){var e,t,n=arguments,r=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in r||!n[t].hasOwnProperty(e)||(r[e]=n[t][e]);return r},f=function(e,t){return{value:e,name:t}};a.DEBUG=f(1,"DEBUG"),a.INFO=f(2,"INFO"),a.TIME=f(3,"TIME"),a.WARN=f(4,"WARN"),a.ERROR=f(8,"ERROR"),a.OFF=f(99,"OFF");var p=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};p.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},getLevel:function(){return this.context.filterLevel},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(a.DEBUG,arguments)},info:function(){this.invoke(a.INFO,arguments)},warn:function(){this.invoke(a.WARN,arguments)},error:function(){this.invoke(a.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(a.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(a.TIME,[e,"end"])},invoke:function(e,t){s&&this.enabledFor(e)&&s(t,c({level:e},this.context))}};var d=new p({filterLevel:a.OFF});!function(){var e=a;e.enabledFor=l(d,d.enabledFor),e.debug=l(d,d.debug),e.time=l(d,d.time),e.timeEnd=l(d,d.timeEnd),e.info=l(d,d.info),e.warn=l(d,d.warn),e.error=l(d,d.error),e.log=e.info}(),a.setHandler=function(e){s=e},a.setLevel=function(e){d.setLevel(e);for(var t in u)u.hasOwnProperty(t)&&u[t].setLevel(e)},a.getLevel=function(){return d.getLevel()},a.get=function(e){return u[e]||(u[e]=new p(c({name:e},d.context)))},a.createDefaultHandler=function(e){e=e||{},e.formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},n=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(r,o){r=Array.prototype.slice.call(r);var i,s=console.log;o.level===a.TIME?(i=(o.name?"["+o.name+"] ":"")+r[0],"start"===r[1]?console.time?console.time(i):t[i]=(new Date).getTime():console.timeEnd?console.timeEnd(i):n(s,[i+": "+((new Date).getTime()-t[i])+"ms"])):(o.level===a.WARN&&console.warn?s=console.warn:o.level===a.ERROR&&console.error?s=console.error:o.level===a.INFO&&console.info?s=console.info:o.level===a.DEBUG&&console.debug&&(s=console.debug),e.formatter(r,o),n(s,r))}},a.useDefaults=function(e){a.setLevel(e&&e.defaultLevel||a.DEBUG),a.setHandler(a.createDefaultHandler(e))},r=a,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o)}()}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={WIDGET_LOADED:1,MEDIA_LOADED:2,PLAY:3,PLAY_REACHED_25:4,PLAY_REACHED_50:5,PLAY_REACHED_75:6,PLAY_REACHED_100:7,OPEN_EDIT:8,OPEN_VIRAL:9,OPEN_DOWNLOAD:10,OPEN_REPORT:11,BUFFER_START:12,BUFFER_END:13,OPEN_FULL_SCREEN:14,CLOSE_FULL_SCREEN:15,REPLAY:16,SEEK:17,OPEN_UPLOAD:18,SAVE_PUBLISH:19,CLOSE_EDITOR:20,PRE_BUMPER_PLAYED:21,POST_BUMPER_PLAYED:22,BUMPER_CLICKED:23,PREROLL_STARTED:24,MIDROLL_STARTED:25,POSTROLL_STARTED:26,OVERLAY_STARTED:27,PREROLL_CLICKED:28,MIDROLL_CLICKED:29,POSTROLL_CLICKED:30,OVERLAY_CLICKED:31,PREROLL_25:32,PREROLL_50:33,PREROLL_75:34,MIDROLL_25:35,MIDROLL_50:36,MIDROLL_75:37,POSTROLL_25:38,POSTROLL_50:39,POSTROLL_75:40};t.default=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(t){r(this,e),this.eventType=t,this.isFirstInSession=!1,this.eventTimestamp=(new Date).getTime()};t.default=o}])});
//# sourceMappingURL=playkit-kanalytics.min.js.map